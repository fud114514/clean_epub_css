# EPUB CSS 清理工具 (EPUB CSS Cleaner)

这是一个简单的 Windows 命令行工具 (`.exe`)，用于移除 EPUB 电子书文件中嵌入的特定 CSS 样式规则。

主要目的是帮助用户清理那些可能干扰阅读体验、导致排版混乱或与某些阅读器/设备不兼容的样式，例如强制的字体、行高、缩进或颜色等。

## 主要功能

*   **移除特定 CSS 样式：** 自动查找并移除以下 CSS 规则：
    *   `text-indent`
    *   `line-height`
    *   `font-size`
    *   `height`
    *   `font-family`
    *   `color`
    *   `display: block`
*   **无需环境配置：** 这是一个独立的 `.exe` 文件，在 Windows 系统上无需安装 Python 或其他依赖即可运行。
*   **使用简单：** 只需将 `.exe` 文件放在包含 EPUB 文件的目录下，双击运行即可。
*   **原地修改：** 直接修改原始 EPUB 文件，不创建副本。**（请务必备份原文件！）**
*   **批量处理：** 自动处理其所在文件夹内的所有 `.epub` 文件（不包括子文件夹）。

## 如何获取

1.  访问本仓库的 [Releases](https://github.com/你的用户名/你的仓库名/releases) 页面。 (你需要替换这里的链接为你实际的 GitHub Releases 页面链接)
2.  下载最新版本的 `clean_epub_css.exe` 文件。

## 使用方法

1.  **极其重要：在运行此工具前，请务必备份你想要处理的 EPUB 文件！** 由于该工具直接修改原文件，如果处理过程中出现任何问题或你不满意结果，备份是恢复文件的唯一途径。
2.  将下载好的 `clean_epub_css.exe` 文件 **复制或移动** 到你存放 `.epub` 文件的文件夹中。
3.  **双击**运行 `clean_epub_css.exe` 文件。
4.  此时会弹出一个命令行窗口，工具会自动开始扫描并处理该文件夹下的所有 `.epub` 文件。
    *   你会看到类似以下的输出信息：
        ```
        将在脚本所在目录 'C:\Users\YourUser\Desktop\MyEpubs' 中查找并原地修改 EPUB 文件...
        将移除以下 CSS 样式: text-indent, line-height, font-size, height, font-family, color, display:block
        警告: 操作将直接修改原文件！建议提前备份。
        --------------------
        开始处理 (原地修改): example1.epub
          已清理: Styles/style.css
          正在重新打包修改后的内容...
          正在替换原文件...
        处理完成 (原地修改): example1.epub
        开始处理 (原地修改): another_book.epub
          信息: 在 another_book.epub 中未找到 CSS 文件。
        --------------------

        --- 任务完成 ---
        已尝试处理文件数: 2
        处理成功（包含未修改）文件数: 2
        处理失败文件数: 0

        按 Enter 键退出...
        ```
5.  处理完成后，命令行窗口会显示“按 Enter 键退出...”，此时按回车键即可关闭窗口。你的 EPUB 文件已经被修改。

## 注意事项

*   **备份！备份！备份！** 请再次确认你已经备份了重要文件。
*   **仅限 Windows:** 此 `.exe` 文件仅适用于 Windows 操作系统。
*   **当前目录：** 工具只处理其所在的当前文件夹，不会查找或处理子文件夹中的 EPUB 文件。
*   **原地修改风险：** 虽然脚本设计上在出错时应尽量保持原文件不变，但不能 100% 保证在所有异常情况下文件安全。备份是关键。
*   **杀毒软件误报：** 某些杀毒软件可能会将使用 PyInstaller 打包的 `.exe` 文件（尤其是单文件模式）标记为潜在威胁。这通常是误报。如果你信任此工具的来源，可以将文件添加到杀毒软件的信任列表或临时禁用实时保护来运行。
*   **编码问题：** 脚本默认尝试使用 `UTF-8` 编码读取 CSS 文件。如果失败，会尝试 `latin-1`。对于使用其他罕见编码的 CSS 文件，可能无法正确处理或导致乱码。
*   **效果并非万能：** EPUB 结构复杂多样，此工具不保证对所有 EPUB 文件都完美有效。某些样式可能嵌入在 HTML 标签的 `style` 属性中，本工具不会处理这种情况。

## 工作原理简述

该 `.exe` 文件是使用 [PyInstaller](https://www.pyinstaller.org/) 将一个 Python 脚本打包而成的。脚本的主要工作流程如下：

1.  获取 `.exe` 文件所在的目录。
2.  遍历该目录下的所有 `.epub` 文件。
3.  对于每个 `.epub` 文件：
    *   将其（本质上是一个 ZIP 压缩包）解压到一个临时文件夹。
    *   遍历解压后的文件，找到所有 `.css` 文件。
    *   读取 `.css` 文件内容。
    *   使用正则表达式查找并移除预设的 CSS 样式规则。
    *   如果内容有修改，则将修改后的内容写回 `.css` 文件。
    *   将临时文件夹中的所有内容重新打包成一个新的临时 EPUB 文件。
    *   用这个新的临时 EPUB 文件覆盖原始的 EPUB 文件。
    *   清理临时文件和目录。

## 许可证 (License)

本项目采用 [MIT License](LICENSE) 授权。（如果你的仓库还没有 LICENSE 文件，可以创建一个，或者选择其他你喜欢的开源许可证，并更新这里的链接）
